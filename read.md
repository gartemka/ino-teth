SQL Test Task
Описание задания

Для выполнения этого задания вам нужно будет создать структуру базы данных для банковской сферы, используя SQL. Структура базы данных должна быть нормализована до третьей нормальной формы (3NF), что обеспечит отсутствие избыточности и улучшит целостность данных.

Предметная область: банковская сфера

    У одного банка могут быть филиалы в нескольких городах. В одном городе может быть несколько филиалов.

    В одном банке у клиента может быть только один аккаунт (аналог расчетного счета).

    К каждому аккаунту могут быть привязаны несколько карт, но также возможны аккаунты без карт.

    У каждого клиента обязательно должен быть один социальный статус.

Правила

    Нормализация базы данных: Структура базы данных должна быть построена по третьей нормальной форме (3NF).

    Форматирование запросов: Запросы должны быть написаны правильно и форматированы должным образом. Несоответствие форматирования приведет к отклонению запросов.

    SQL файл: Все запросы и процедуры должны быть размещены в одном SQL файле.

    Ручное написание скриптов: Скрипты должны быть написаны вручную, не используя генераторы кода.

    Тестирование процедур: Для всех stored procedures/functions нужно добавить код для проверки их работоспособности. Для каждой процедуры должен быть пример работы с запросами:

        SELECT запрос до выполнения процедуры.

        EXEC для вызова процедуры.

        SELECT запрос после выполнения процедуры, чтобы проверить правильность выполнения.

    Проверка данных: Для всех процедур необходимо добавлять проверку тех данных, которые изменяются в этих процедурах.

Задания

    Создание структуры базы данных:

        Создайте таблицы для банков, филиалов, клиентов, аккаунтов, карт, социальных статусов.

        Каждая таблица должна содержать минимум 5 значений в данных словарях.

        Все таблицы должны быть нормализованы до третьей нормальной формы.

    Запрос для получения списка банков с филиалами в определенном городе (например, в "Город X"):

        Напишите запрос, который покажет список всех банков, у которых есть филиалы в указанном городе.

    Запрос для получения списка карточек с указанием имени владельца, баланса и названия банка:

        Напишите запрос, который выведет карточки, указав имя владельца карты, баланс и название банка.

    Запрос для получения списка банковских аккаунтов, у которых баланс не совпадает с суммой баланса по карточкам:

        Напишите запрос, который покажет банковские аккаунты, у которых баланс отличается от суммы баланса всех привязанных карт. Также выведите разницу между балансом аккаунта и суммой балансов карт.

    Запрос для получения количества банковских карт для каждого социального статуса:

        Напишите два запроса:

            Используя GROUP BY, получите количество карт для каждого социального статуса.

            Напишите запрос с подзапросом для получения того же результата.

    Создание stored procedure для добавления $10 на каждый банковский аккаунт для определенного социального статуса:

        Напишите процедуру, которая добавляет по $10 на каждый аккаунт клиентов с заданным социальным статусом.

        Процедура должна принимать ID социального статуса как входной параметр и обрабатывать исключительные ситуации:

            Если задан неверный ID социального статуса.

            Если у данного статуса нет привязанных аккаунтов.

    Запрос для получения списка доступных средств для каждого клиента:

        Напишите запрос, который определяет, сколько средств доступно для перевода на карту. Например, если на аккаунте 60 рублей, а на двух картах по 15 рублей, то доступно для перевода 30 рублей.

    Создание процедуры для перевода суммы со счета на карту:

        Напишите процедуру, которая переводит указанную сумму с банковского счета на одну из карт этого же аккаунта. При этом деньги на счете остаются, но баланс карты увеличивается.

        Используйте транзакцию для безопасного выполнения перевода.

    Создание триггера для проверки корректности баланса:

        Напишите триггер на таблицы Accounts и Cards, чтобы предотвратить изменение баланса:

            Нельзя установить баланс на счете меньше суммы балансов всех карт, привязанных к этому аккаунту.

            Нельзя установить баланс карты, если сумма балансов всех карт будет превышать баланс аккаунта.

Инструкция по созданию Pull Request

    Создание пустого SQL файла:

        В главной ветке вашего репозитория создайте пустой SQL файл, в котором будет храниться весь код.

    Создание дочерней ветки:

        Создайте дочернюю ветку от главной для разработки.

    Добавление кода в дочерней ветке:

        В дочерней ветке добавьте в пустой SQL файл все необходимые запросы, процедуры и триггеры.

    Создание Pull Request:

        Создайте Pull Request из дочерней ветки в главную.

        В описании Pull Request укажите, что это решение по SQL тестовому заданию.

    Отправка на проверку ментору:

        Отправьте Pull Request на проверку своему ментору. Ментор оставит комментарии в PR, которые помогут вам улучшить код.